<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EduTimer - Manajemen Waktu Belajar</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SweetAlert2 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-4">

  <!-- Konten Utama -->
  <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8 relative">
    
    <!-- Bagian Timer -->
    <div id="timerSection" class="mb-8">
      <div id="timer" class="text-5xl font-bold text-white bg-red-500 p-6 rounded-lg shadow-md text-center">
        25:00
      </div>

      <!-- Tombol Timer + Tombol Mode Fokus -->
      <div class="flex flex-wrap justify-center gap-4 mt-4">
        <button id="startBtn" 
                class="bg-blue-600 text-white px-6 py-2 rounded-lg shadow hover:bg-blue-700">
          Mulai
        </button>
        <button id="pauseBtn" 
                class="bg-yellow-500 text-white px-6 py-2 rounded-lg shadow hover:bg-yellow-600">
          Pause
        </button>
        <button id="resetBtn" 
                class="bg-red-500 text-white px-6 py-2 rounded-lg shadow hover:bg-red-600">
          Reset
        </button>
        <button id="focusModeBtn" 
                class="bg-indigo-500 text-white px-6 py-2 rounded-lg shadow hover:bg-indigo-600">
          Mode Fokus
        </button>
      </div>
    </div>

    <!-- Pengaturan Waktu Belajar (Menggunakan Form agar ENTER bisa submit) -->
    <form id="settingsForm" class="nonFocus mb-8">
      <h2 class="text-xl font-semibold text-gray-700 mb-2">Pengaturan Waktu Belajar</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-600">Waktu Belajar (menit):</label>
          <input id="studyTime" 
                 type="number" 
                 min="1" 
                 value="25" 
                 class="mt-1 border rounded w-full p-2" 
                 required />
        </div>
        <div>
          <label class="block text-gray-600">Waktu Istirahat (menit):</label>
          <input id="breakTime" 
                 type="number" 
                 min="1" 
                 value="5" 
                 class="mt-1 border rounded w-full p-2"
                 required />
        </div>
      </div>
      <button id="saveSettings" 
              type="submit"
              class="bg-green-500 text-white px-6 py-2 rounded-lg shadow mt-4 hover:bg-green-600">
        Simpan Pengaturan
      </button>
    </form>

    <!-- Tambah Tugas -->
    <div id="tasksSection" class="nonFocus mb-8">
      <h2 class="text-xl font-semibold text-gray-700 mb-2">Tambah Tugas</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Input Mapel -->
        <input id="taskMapel" 
               type="text" 
               placeholder="Mapel (misal: IPA, MTK, dll.)" 
               class="border p-2 rounded w-full" />
        <!-- Input Tugas -->
        <input id="taskDescription" 
               type="text" 
               placeholder="Tugas (misal: Mencatat Bab 1)" 
               class="border p-2 rounded w-full" />
        <!-- Pilih Hari -->
        <select id="taskDay" 
                class="border p-2 rounded w-full">
          <option value="" disabled selected>Pilih Hari</option>
          <option value="Senin">Senin</option>
          <option value="Selasa">Selasa</option>
          <option value="Rabu">Rabu</option>
          <option value="Kamis">Kamis</option>
          <option value="Jumat">Jumat</option>
          <option value="Sabtu">Sabtu</option>
          <option value="Minggu">Minggu</option>
        </select>
        <!-- Deadline -->
        <input id="taskDeadline" 
               type="date" 
               class="border p-2 rounded w-full" />
      </div>
      <button id="addTask" 
              class="bg-blue-500 text-white px-6 py-2 rounded-lg shadow mt-4 hover:bg-blue-600">
        Tambah Tugas
      </button>

      <!-- Daftar Tugas -->
      <ul id="taskList" class="mt-4 space-y-2"></ul>
    </div>

    <!-- Jadwal Pelajaran -->
    <div id="scheduleSection" class="nonFocus">
      <h2 class="text-xl font-semibold text-gray-700 mb-2">Jadwal Pelajaran</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input id="subjectInput" 
               type="text" 
               placeholder="Nama Mapel..." 
               class="border p-2 rounded w-full" />
        <select id="subjectDay" 
                class="border p-2 rounded w-full">
          <option value="" disabled selected>Pilih Hari</option>
          <option value="Senin">Senin</option>
          <option value="Selasa">Selasa</option>
          <option value="Rabu">Rabu</option>
          <option value="Kamis">Kamis</option>
          <option value="Jumat">Jumat</option>
          <option value="Sabtu">Sabtu</option>
          <option value="Minggu">Minggu</option>
        </select>
      </div>
      <button id="addSubject" 
              class="bg-purple-500 text-white px-6 py-2 rounded-lg shadow mt-4 hover:bg-purple-600">
        Tambah Pelajaran
      </button>
      <div class="mt-4">
        <h3 class="text-lg font-semibold text-gray-700" id="scheduleTitle">
          Jadwal untuk hari ini
        </h3>
        <ul id="subjectList" class="mt-2 space-y-2"></ul>
      </div>
    </div>
  </div>

  <script>
<<<<<<< HEAD
    // ========== AUDIO NOTIFIKASI ========== 
=======
    // ========== AUDIO NOTIFIKASI ==========
>>>>>>> 4409a30f36c0ba45c6bbf0ca9e3a3b9703426749
    // Pastikan file end.mp3 tersedia di folder assets/musics/
    const endSound = new Audio('assets/musics/end.mp3');

    // ========== TIMER LOGIC ==========
    let timerElement = document.getElementById('timer');
    let startBtn = document.getElementById('startBtn');
    let pauseBtn = document.getElementById('pauseBtn');
    let resetBtn = document.getElementById('resetBtn');

    let studyTimeInput = document.getElementById('studyTime');
    let breakTimeInput = document.getElementById('breakTime');
    let settingsForm = document.getElementById('settingsForm');

    let studyDuration = parseInt(studyTimeInput.value) * 60;
    let breakDuration = parseInt(breakTimeInput.value) * 60;
    let timeInSeconds = studyDuration;
    let timerInterval;
    let isRunning = false;
    let isStudySession = true; // true: sesi belajar, false: sesi istirahat

    // Fungsi menampilkan waktu (mm:ss)
    function formatTime(seconds) {
      let minutes = Math.floor(seconds / 60).toString().padStart(2, '0');
      let remainingSeconds = (seconds % 60).toString().padStart(2, '0');
      return `${minutes}:${remainingSeconds}`;
    }

    // Update tampilan timer
    function updateTimer() {
      timerElement.innerText = formatTime(timeInSeconds);
    }

    // Ubah warna latar timer (merah=belajar, hijau=istirahat)
    function updateTimerBackground() {
      if (isStudySession) {
        timerElement.classList.remove('bg-green-500');
        timerElement.classList.add('bg-red-500');
      } else {
        timerElement.classList.remove('bg-red-500');
        timerElement.classList.add('bg-green-500');
      }
    }

    // Fungsi helper untuk SweetAlert
    function showAlert(title, text, icon='info') {
      Swal.fire({
        title: title,
        text: text,
        icon: icon,
        confirmButtonText: 'OK'
      });
    }

    // Berpindah sesi belajar <-> istirahat
    function switchSession() {
      // Putar suara notifikasi setiap sesi berakhir
      endSound.play().catch(err => {
        console.log("Audio belum bisa diputar otomatis:", err);
      });

      if (isStudySession) {
        // Selesai belajar, mulai istirahat
        isStudySession = false;
        timeInSeconds = breakDuration;
        updateTimerBackground();
        showAlert('Waktu belajar selesai!', 'Mulai istirahat.', 'success');
      } else {
        // Selesai istirahat, mulai belajar
        isStudySession = true;
        timeInSeconds = studyDuration;
        updateTimerBackground();
        showAlert('Istirahat selesai!', 'Mulai belajar.', 'success');
      }
      updateTimer();
    }

    // Mulai timer
    function startTimer() {
      if (!isRunning) {
        timerInterval = setInterval(() => {
          if (timeInSeconds > 0) {
            timeInSeconds--;
            updateTimer();
          } else {
            clearInterval(timerInterval);
            isRunning = false; 
            switchSession();
          }
        }, 1000);
        isRunning = true;
      }
    }

    // Jeda timer
    function pauseTimer() {
      clearInterval(timerInterval);
      isRunning = false;
    }

    // Reset timer ke sesi belajar
    function resetTimer() {
      clearInterval(timerInterval);
      isRunning = false;
      isStudySession = true;
      timeInSeconds = studyDuration;
      updateTimerBackground();
      updateTimer();
    }

    // Handler simpan pengaturan
    function saveSettingsHandler() {
      studyDuration = parseInt(studyTimeInput.value) * 60;
      breakDuration = parseInt(breakTimeInput.value) * 60;
      resetTimer();
      showAlert('Pengaturan Disimpan', 'Waktu belajar & istirahat telah diperbarui.', 'success');
    }

    // Saat form disubmit (ENTER atau klik tombol)
    settingsForm.addEventListener('submit', (e) => {
      e.preventDefault();
      saveSettingsHandler();
    });

    // Tombol timer
    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);

    // Inisialisasi tampilan awal timer
    updateTimer();
    updateTimerBackground();

    // ========== DATA & VARIABEL UNTUK TUGAS DAN JADWAL ==========

    // Array untuk menyimpan jadwal pelajaran
    let subjectSchedule = []; // { subject: 'IPA', day: 'Sabtu' }

    // Array untuk menyimpan tugas
    let tasks = []; // { mapel: 'IPA', tugas: 'Mencatat Bab 1', day: 'Sabtu', deadline: '2023-03-04' }

    // ========== BAGIAN TUGAS ==========

    let taskMapelInput = document.getElementById('taskMapel');
    let taskDescriptionInput = document.getElementById('taskDescription');
    let taskDaySelect = document.getElementById('taskDay');
    let taskDeadlineInput = document.getElementById('taskDeadline');
    let addTaskBtn = document.getElementById('addTask');
    let taskList = document.getElementById('taskList');

    // Fungsi untuk menampilkan daftar semua tugas di bawah "Tambah Tugas"
    function displayAllTasks() {
      taskList.innerHTML = "";
      if (tasks.length === 0) {
        taskList.innerHTML = `<li class="bg-gray-200 p-2 rounded">Belum ada tugas.</li>`;
        return;
      }
      tasks.forEach((t, index) => {
        let li = document.createElement('li');
        li.classList = "bg-gray-200 p-2 rounded flex justify-between items-center";
        let taskInfo = document.createElement('div');
        let deadlineText = t.deadline ? new Date(t.deadline).toLocaleDateString() : '-';
        taskInfo.innerHTML = `
          <span class="font-semibold">${t.mapel}</span> - ${t.tugas}<br>
          <small class="text-gray-600">Hari: ${t.day}, Deadline: ${deadlineText}</small>
        `;
        let deleteBtn = document.createElement('button');
        deleteBtn.innerText = "X";
        deleteBtn.classList = "text-red-500 ml-2";
        deleteBtn.onclick = () => {
          tasks.splice(index, 1);
          displayAllTasks();
          displaySubjects();
        };
        li.appendChild(taskInfo);
        li.appendChild(deleteBtn);
        taskList.appendChild(li);
      });
    }

    addTaskBtn.addEventListener('click', () => {
      let mapelVal = taskMapelInput.value.trim();
      let tugasVal = taskDescriptionInput.value.trim();
      let dayVal = taskDaySelect.value;
      let deadlineVal = taskDeadlineInput.value;

      if (mapelVal && tugasVal && dayVal) {
        tasks.push({
          mapel: mapelVal,
          tugas: tugasVal,
          day: dayVal,
          deadline: deadlineVal
        });
        taskMapelInput.value = "";
        taskDescriptionInput.value = "";
        taskDaySelect.selectedIndex = 0;
        taskDeadlineInput.value = "";
        displayAllTasks();
        displaySubjects(); // perbarui jadwal jika ada tugas baru
      } else {
        showAlert('Gagal Menambah Tugas', 'Masukkan mapel, tugas, dan hari dengan benar.', 'error');
      }
    });

    // ========== BAGIAN JADWAL PELAJARAN ==========
    let subjectInput = document.getElementById('subjectInput');
    let subjectDaySelect = document.getElementById('subjectDay');
    let addSubjectBtn = document.getElementById('addSubject');
    let subjectList = document.getElementById('subjectList');
    let scheduleTitle = document.getElementById('scheduleTitle');

    addSubjectBtn.addEventListener('click', () => {
      let subjectText = subjectInput.value.trim();
      let subjectDay = subjectDaySelect.value;
      if (subjectText && subjectDay) {
        subjectSchedule.push({ subject: subjectText, day: subjectDay });
        subjectInput.value = "";
        subjectDaySelect.selectedIndex = 0;
        displaySubjects();
      } else {
        showAlert('Gagal Menambah Pelajaran', 'Masukkan nama mapel dan pilih hari dengan benar.', 'error');
      }
    });

    // Mapping hari (0: Minggu, 1: Senin, dst.)
    const daysMap = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

    // Menentukan hari apa yang akan ditampilkan (hari ini atau besok jika >=18:00)
    function getCurrentScheduleDay() {
      let now = new Date();
      // Jika sudah malam (≥18:00), tampilkan jadwal untuk hari berikutnya
      if (now.getHours() >= 18) {
        now.setDate(now.getDate() + 1);
      }
      return daysMap[now.getDay()];
    }

    // Menampilkan jadwal beserta tugas yang cocok
    function displaySubjects() {
      subjectList.innerHTML = "";
      let displayDay = getCurrentScheduleDay();
      scheduleTitle.innerText = `Jadwal untuk hari ${displayDay}`;
      
      // Filter jadwal yang sesuai hari ini/besok
      let filtered = subjectSchedule.filter(item => item.day === displayDay);
      if (filtered.length === 0) {
        subjectList.innerHTML = `
          <li class='bg-gray-200 p-2 rounded'>Tidak ada jadwal untuk hari ini.</li>
        `;
      } else {
        filtered.forEach(item => {
          // Buat list item untuk mapel
          let li = document.createElement('li');
<<<<<<< HEAD
          li.classList = "bg-gray-200 p-2 rounded mb-2";

          // Konten utama: Nama mapel
          let subjectHtml = `<div class="font-semibold text-lg">${item.subject}</div>`;

          // Cari tugas yang match day & mapel
          let matchedTasks = tasks.filter(t => 
            t.day === displayDay && 
            t.mapel.toLowerCase() === item.subject.toLowerCase()
          );
          if (matchedTasks.length > 0) {
            subjectHtml += `<ul class="ml-4 mt-1 list-disc">`;
            matchedTasks.forEach(taskItem => {
              let deadlineText = taskItem.deadline 
                ? new Date(taskItem.deadline).toLocaleDateString() 
                : '-';
              subjectHtml += `
                <li class="mt-1">
                  <span class="text-gray-800">Tugas: ${taskItem.tugas}</span>
                  <small class="text-gray-600"> (Deadline: ${deadlineText})</small>
                </li>
              `;
            });
            subjectHtml += `</ul>`;
          } else {
            subjectHtml += `<div class="text-sm text-gray-600 ml-4 mt-1 italic">Tidak ada tugas</div>`;
          }

          li.innerHTML = subjectHtml;
=======
          li.classList = "bg-gray-200 p-2 rounded flex justify-between items-center";
          // Hanya tampilkan nama mapel, tanpa menampilkan harinya
          li.innerHTML = `
            <span class="font-semibold">${item.subject}</span>
          `;
          let deleteBtn = document.createElement('button');
          deleteBtn.innerText = "X";
          deleteBtn.classList = "text-red-500 ml-2";
          deleteBtn.onclick = () => {
            subjectSchedule = subjectSchedule.filter(sub => sub !== item);
            displaySubjects();
          };
          li.appendChild(deleteBtn);
>>>>>>> 4409a30f36c0ba45c6bbf0ca9e3a3b9703426749
          subjectList.appendChild(li);
        });
      }
    }

    // Panggil saat pertama kali load
    displayAllTasks();
    displaySubjects();

    // ========== MODE FOKUS ==========
    let isFocusMode = false;
    let focusModeBtn = document.getElementById('focusModeBtn');
    focusModeBtn.addEventListener('click', toggleFocusMode);

    function toggleFocusMode() {
      isFocusMode = !isFocusMode;
      // Sembunyikan elemen dengan class 'nonFocus'
      document.querySelectorAll('.nonFocus').forEach(el => {
        el.classList.toggle('hidden', isFocusMode);
      });
      focusModeBtn.innerText = isFocusMode ? "Keluar Mode Fokus" : "Mode Fokus";
    }
  </script>
</body>
</html>
